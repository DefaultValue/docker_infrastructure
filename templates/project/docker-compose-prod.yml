version: "3.7"
services:
  php-apache:
    build:
      args:
        - DEVELOPER_MODE=1 # needed for the build stage
    user: docker:docker
    sysctls:
      - net.ipv4.ip_unprivileged_port_start=0
    labels:
      # develop with extension that allows setting livereload host and port - https://github.com/lokcito/livereload-extensions
      - traefik.http.routers.example-router-grunt.rule=Host(`example-dev.com`, `example-2-dev.com`) || Host(`www.example-dev.com`, `www.example-2-dev.com`)
      - traefik.http.routers.example-router-grunt.entrypoints=livereload-http
      - traefik.http.routers.example-router-grunt.service=example-service-grunt
      - traefik.http.services.example-service-grunt.loadbalancer.server.port=35729
      - traefik.http.services.example-service-grunt.loadbalancer.server.scheme=http
    extra_hosts:
      # For Linux users only till docker.host.internal is not available by default
      # https://github.com/docker/libnetwork/pull/2348/files
      - "host.docker.internal:172.17.0.1"
    external_links:
      - mailhog
    environment:
      - PHP_IDE_CONFIG=serverName=example.com
      # For Mailhog and mhsendmail (Sendmail replacement)
      - ADDITIONAL_PATH=/usr/local/go/bin

# IMPORTANT FOR MAC USERS!!!
# ALL BELOW is for Mac only to enable docker sync stack
#    volumes:
#      - example.com-sync:/var/www/html:nocopy

#volumes:
#  example.com-sync:
#    external: true